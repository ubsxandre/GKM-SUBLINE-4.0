{% extends "layouts/base.html" %}

{% block title %} Access Management {% endblock %}

{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

<div class="container-xxl flex-grow-1 container-p-y">
  <div class="row g-6 mb-6">
    <div class="col-sm-6 col-xl-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="me-1">
              <p class="text-heading mb-1">Session</p>
              <div class="d-flex align-items-center">
                <h4 class="mb-1 me-2" id="card_session_users">0</h4>
                <!-- <p class="text-success mb-1">(+29%)</p> -->
              </div>
              <small class="mb-0">Total Users</small>
            </div>
            <div class="avatar">
              <div class="avatar-initial bg-label-primary rounded-3">
                <div class="ri-group-line ri-26px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="me-1">
              <p class="text-heading mb-1">All Users</p>
              <div class="d-flex align-items-center">
                <h4 class="mb-1 me-1" id="card_all_users">0</h4>
                <!-- <p class="text-success mb-1">(+18%)</p> -->
              </div>
              <small class="mb-0">Total Users</small>
            </div>
            <div class="avatar">
              <div class="avatar-initial bg-label-danger rounded-3">
                <div class="ri-user-add-line ri-26px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="me-1">
              <p class="text-heading mb-1">Active Users</p>
              <div class="d-flex align-items-center">
                <h4 class="mb-1 me-1" id="card_active_users">0</h4>
                <!-- <p class="text-danger mb-1">(-14%)</p> -->
              </div>
              <small class="mb-0">Total Users</small>
            </div>
            <div class="avatar">
              <div class="avatar-initial bg-label-success rounded-3">
                <div class="ri-user-follow-line ri-26px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="me-1">
              <p class="text-heading mb-1">Pending Users</p>
              <div class="d-flex align-items-center">
                <h4 class="mb-1 me-1" id="card_pending_users">0</h4>
                <!-- <p class="text-success mb-1">(+42%)</p> -->
              </div>
              <small class="mb-0">Total Users</small>
            </div>
            <div class="avatar">
              <div class="avatar-initial bg-label-warning rounded-3">
                <div class="ri-user-search-line ri-26px"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    $(document).ready(function () {
      $.ajax({
        url: '/api/m-akses-management',
        method: 'GET',
        dataType: 'JSON',  
        data: {
          nik: '',
        },
        success: function(response) {
          pending = 0
          active = 0
          all = response.data.length
          for(row of response.data) {
            if (row.id_role == null){
              pending += 1
            }else{
              active += 1
            }
          } 
          $("#card_active_users").text(active)
          $("#card_pending_users").text(pending)
          $("#card_all_users").text(all)
        },
        error: function(jqXHR, textStatus, errorThrown) {
          console.error('Error:', textStatus, errorThrown); 
        }
      });
      

      $.get("/api/akses", function(response) {
        $("#card_session_users").text(response.data)
      });

    })
  </script>


  <div class="card">
    <div class="card-header border-bottom">
      <h5 class="card-title mb-0">Access Management</h5>
    </div>
    <div class="card-datatable table-responsive">
      <table class="table" id="datatable">
        <thead>
          <tr>
            <th>Action</th>
            <th>User</th>
            <th>Departemen</th>
            <th>Role</th>
            <th>Golongan</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>



<!-- MODAL DETAIL (VIEW) -->
<div class="modal animate__animated animate__zoomIn" id="modal-detail" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-simple modal-dialog-centered modal-add-new-role">
    <div class="modal-content">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body p-0">
        <div class="user-profile-header d-flex flex-column flex-sm-row text-sm-start text-center mb-5">
          <div class="flex-shrink-0 mt-n2 mx-sm-0 mx-auto">
            <img src="static/assets/img/avatars/1.png" alt="user image" class="d-block h-auto ms-0 ms-sm-5 rounded-4 user-profile-img">
          </div>
          <div class="flex-grow-1 mt-4 mt-sm-12">
            <div class="d-flex align-items-md-end align-items-sm-start align-items-center justify-content-md-between justify-content-start mx-5 flex-md-row flex-column gap-6">
              <div class="user-profile-info">
                <h4 class="mb-2" id="nama_profile">MOCH FACHRIYAN</h4>
                <ul class="list-inline mb-3 d-flex align-items-center flex-wrap justify-content-sm-start justify-content-center gap-4">
                  <li class="list-inline-item">
                    <span class="fw-medium" id="nik_profile">016969</span> | <span class="fw-medium" id="role_profile">ADMIN</span>
                  </li>
                </ul>
                <ul class="list-inline mb-0 d-flex align-items-center flex-wrap justify-content-sm-start justify-content-center gap-4">
                  <li class="list-inline-item">
                    <i class="ri-shield-user-fill me-2 ri-24px"></i><span class="fw-medium" id="golongan_profile">Golongan 5</span>
                  </li>
                  <li class="list-inline-item">
                    <i class="ri-map-pin-line me-2 ri-24px"></i><span class="fw-medium" id="departemen_profile">QMS</span>
                  </li>
                  <li class="list-inline-item">
                    <i class="ri-calendar-line me-2 ri-24px"></i><span class="fw-medium" id="created_date_profile"> Joined September 2024</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mb-6">
          <!-- <h4 class="role-title mb-2 pb-0">Detail User </h4> -->
          <p>Set role permissions</p>
        </div>

        <!-- Add role form -->
        <form id="addRoleForm" class="row g-3" onsubmit="return false">
          <div class="col-12 mb-3">
            <div class="form-floating form-floating-outline">
              <select class="form-select" id="modalRoleNameDetail" aria-label="Default select example">
              </select>
              <label for="modalRoleNameDetail">Role Name</label>
            </div>
          </div>
          <div class="col-12">
            <h5 class="mb-6">Role Permissions</h5>
            <!-- Permission table -->
            <div class="table-responsive">
              <table class="table table-flush-spacing" id="table_det_view">
                <tbody>

                </tbody>
              </table>
            </div>
            <!-- Permission table -->
          </div>
          <div class="col-12 d-flex flex-wrap justify-content-center gap-4 row-gap-4">
            <button
              type="reset"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
              aria-label="Close">
              Cancel
            </button>
          </div>
        </form>

        <script>
          // Select All checkbox click
          $(document).on("click", "#selectAllView", function(){
            checked = $(this).prop("checked")
            $(".select-all-view").prop("checked", checked)
          })
        </script>        
        <!--/ Add role form -->
      </div>
    </div>
  </div>
</div>

<!-- MODAL UPDATE -->
<div class="modal animate__animated animate__zoomIn" id="modal-update" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-simple modal-dialog-centered modal-add-new-role">
    <div class="modal-content">
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body p-0">
        <div class="user-profile-header d-flex flex-column flex-sm-row text-sm-start text-center mb-5">
          <div class="flex-shrink-0 mt-n2 mx-sm-0 mx-auto">
            <img src="static/assets/img/avatars/1.png" alt="user image" class="d-block h-auto ms-0 ms-sm-5 rounded-4 user-profile-img">
          </div>
          <div class="flex-grow-1 mt-4 mt-sm-12">
            <div class="d-flex align-items-md-end align-items-sm-start align-items-center justify-content-md-between justify-content-start mx-5 flex-md-row flex-column gap-6">
              <div class="user-profile-info">
                <h4 class="mb-2" id="nama_profile_update">MOCH FACHRIYAN</h4>
                <ul class="list-inline mb-3 d-flex align-items-center flex-wrap justify-content-sm-start justify-content-center gap-4">
                  <li class="list-inline-item">
                    <span class="fw-medium" id="nik_profile_update">016969</span> | <span class="fw-medium" id="role_profile_update">ADMIN</span>
                  </li>
                </ul>
                <ul class="list-inline mb-0 d-flex align-items-center flex-wrap justify-content-sm-start justify-content-center gap-4">
                  <li class="list-inline-item">
                    <i class="ri-shield-user-fill me-2 ri-24px"></i><span class="fw-medium" id="golongan_profile_update">Golongan 5</span>
                  </li>
                  <li class="list-inline-item">
                    <i class="ri-map-pin-line me-2 ri-24px"></i><span class="fw-medium" id="departemen_profile_update">QMS</span>
                  </li>
                  <li class="list-inline-item">
                    <i class="ri-calendar-line me-2 ri-24px"></i><span class="fw-medium" id="created_date_profile_update"> Joined September 2024</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mb-6">
          <!-- <h4 class="role-title mb-2 pb-0">Detail User </h4> -->
          <p>Set role permissions</p>
        </div>

        <!-- Add role form -->
        <form id="addRoleForm" class="row g-3" onsubmit="return false">
          <div class="col-12 mb-3">
            <div class="form-floating form-floating-outline">
              <select class="form-select" id="modalRoleNameUpdate" aria-label="Default select example">
              </select>
              <label for="modalRoleNameUpdate">Role Name</label>
            </div>
          </div>
          <div class="col-12">
            <h5 class="mb-6">Role Permissions</h5>
            <!-- Permission table -->
            <div class="table-responsive">
              <table class="table table-flush-spacing" id="table_det">
                <tbody>
                </tbody>
              </table>
            </div>
            <!-- Permission table -->
          </div>
          <div class="col-12 d-flex flex-wrap justify-content-center gap-4 row-gap-4">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button
              type="reset"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
              aria-label="Close">
              Cancel
            </button>
          </div>
        </form>

        <script>
          // Select All checkbox click
          $(document).on("click", "#selectAll", function(){
            checked = $(this).prop("checked")
            $(".select-all").prop("checked", checked)
          })
          // const selectAll = document.querySelector('#selectAll'),
          //   checkboxList = document.querySelectorAll('[type="checkbox"]');
          // selectAll.addEventListener('change', t => {
          //   checkboxList.forEach(e => {
          //     e.checked = t.target.checked;
          //   });
          // });
        </script>
        
        <!--/ Add role form -->
      </div>
    </div>
  </div>
</div>

<!-- MODAL DELETE -->
<div class="modal fade" id="modal-delete" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content text-center">
      <div class="modal-header flex-column">
        <div class="icon-box">
          <i class="ri-delete-bin-5-line text-danger ri-5x "></i>
        </div>
        <h4 class="modal-title w-100">Are you sure?</h4>
      </div>
      <form id="delete-form">
        <div class="modal-body">
          <input type="hidden" name="" id="id-delete">
          <input type="hidden" name="" id="nik-delete">
          <p>Do you really want to delete these records? This process cannot be undone.</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>





<script type="text/javascript">
  var monthNames = ["January", "February", "March", "April", "May", "June", 
  "July", "August", "September", "October", "November", "December"];

  function getMonthName(monthNumber) {
    // Karena index array dimulai dari 0, kurangi 1 dari angka bulan
    return monthNames[monthNumber - 1];
}

  $(document).ready(function () {
    var table = $('#datatable').DataTable({
      processing: true,
      serverSide: true,
      order: [[5, 'desc']],
      serverMethod: 'POST',
      ajax: {
        url: "/api/m-akses-management",
        data: function(sc){
          sc.mode = 'datatable'
          return sc
        }
      },
      dataType: 'JSON',
      lengthMenu: [[10, 30, 50, 100], [10, 30, 50, 100]],
      paging: true,
      paginate: {
        next: '<i class="ri-arrow-right-s-line"></i>',
        previous: '<i class="ri-arrow-left-s-line"></i>'
      },
      searching: true,
      columns: [
        {
          orderable: false,
          className: 'control',
          data:null,
          render:function(data){
            return `
              <div class="d-flex align-items-center">
                <a href="javascript:;" class="dropdown-item detail-record"><i class="ri-eye-line text-secondary"></i> </a>
                <a href="javascript:;" class="dropdown-item update-record"><i class="ri-edit-box-line text-primary"></i> </a>
                <a href="javascript:;" class="dropdown-item delete-record"><i class="ri-delete-bin-6-line text-danger"></i> </a>
              </div>
            `
          }
        },
        {
          data:null,
          render:function(data){
            return `
              <div class="d-flex justify-content-start align-items-center user-name">
                <div class="avatar-wrapper">
                  <div class="avatar avatar-sm me-3">
                    <img src="static/assets/img/avatars/1.png" alt="Avatar" class="rounded-circle">
                  </div>
                </div>
                <div class="d-flex flex-column">
                  <a href="javascript:void(0)" class="text-truncate text-heading">
                    <span class="fw-medium">${data.nama}</span>
                  </a>
                <small>${data.nik}</small>
                </div> 
              </div>
            `
          }
        },
        {data:'departemen'},
        {
          data:null,
          render:function(data){
            var roles = data.role
            var id_role = data.id_role
            var roleBadgeObj = {
              MANAGER: '<i class="ri-vip-crown-line ri-22px text-danger me-2"></i>',
              SUPERADMIN: '<i class="ri-edit-box-line ri-22px text-info me-2"></i>',
              ADMIN: '<i class="ri-computer-line ri-22px text-primary me-2"></i>',
              OPERATOR: '<i class="ri-user-3-line ri-22px mui-14yvpj7 me-2"></i>',
              DEVELOPER: '<i class="ri-android-fill text-success ri-22px me-2"></i>'
            };
            function getRoleBadge(role) {
              return roleBadgeObj[role] || '<i class="ri-user-line ri-22px text-secondary me-2"></i>'; // default icon
            }

            if (roles != null) {
              return `<span class='text-truncate d-flex align-items-center text-heading'>
                        ${getRoleBadge(roles)} ${roles}
                      </span>`;
            } else {
              return `-`;
            }
            
          }
        },    
        {data:'golongan'},
        {
          data:'status',
          render:function(data){
            var statusObj = {
              "Pending": { title: 'Pending', class: 'bg-label-warning' },
              "Inactive": { title: 'Inactive', class: 'bg-label-secondary' },
              "Active": { title: 'Active', class: 'bg-label-success' },
            };
            return `
              <span class="badge rounded-pill ${statusObj[data].class}"> ${statusObj[data].title} </span>
            `
          }
        },    
      ]
    });

    $(document).on("click", ".detail-record", function () {
      var rdata = table.row($(this).parents('tr')).data()
      $("#nama_profile").text(rdata.nama)
      $("#nik_profile").text(rdata.nik)
      $("#golongan_profile").text(`Golongan ${rdata.golongan}`)
      $("#departemen_profile").text(rdata.departemen)
      renderDropdownRolesView(rdata.id_role, rdata.role)
      checked_access = []
      for(row of rdata.det){
        if(row.status=='checked'){
          checked_access.push(`${row.page}-${row.akses}`)
        }
      }
      renderAccessView(checked_access)
      bulan = rdata.created_date.split('-')[0]
      tahun = rdata.created_date.split('-')[1]
      bergabung = parseInt(bulan);
      monthName = getMonthName(bergabung);
      $("#created_date_profile").text(`Joined ${monthName} ${tahun}`)
      $("#modal-detail").modal("show")
    });

    $(document).on("click", ".update-record", function () {
      var rdata = table.row($(this).parents('tr')).data()
      $("#nama_profile_update").text(rdata.nama)
      $("#nik_profile_update").text(rdata.nik)
      $("#golongan_profile_update").text(`Golongan ${rdata.golongan}`)
      $("#departemen_profile_update").text(rdata.departemen)
      bulan = rdata.created_date.split('-')[0]
      tahun = rdata.created_date.split('-')[1]
      bergabung = parseInt(bulan);
      monthName = getMonthName(bergabung);
      $("#created_date_profile_update").text(`Joined ${monthName} ${tahun}`)
      renderDropdownRoles(rdata.id_role, rdata.role)

      checked_access = []
      for(row of rdata.det){
        if(row.status=='checked'){
          checked_access.push(`${row.page}-${row.akses}`)
        }
      }
      renderAccess(checked_access)
      $("#modal-update").modal("show")
      
    });

    $(document).on("change", "#modalRoleNameUpdate", function(){
      rolemodel = $(this).val()
      var params = {
        id: "",
        id_role: rolemodel,
        id_page: "",
        akses: ""
      }
      if(rolemodel==''){
        renderAccess([])
      }else{
        $.ajax({
          url:'/api/m-akses',
          type: 'GET',
          contentType: 'application/json',
          data: params,       
          success: function(response){
            checked_access = []
            for(row of response.data){
              checked_access.push(`${row.page}-${row.akses}`)
            }
            renderAccess(checked_access)
          }
        })
      }
    })

    $(document).on("submit", "#addRoleForm", function(){
      data_insert = []
      id_role = $("#modalRoleNameUpdate").val()
      div_role = document.getElementById("modalRoleNameUpdate")
      role = div_role.options[div_role.selectedIndex].text
      nik = $("#nik_profile_update").html()
      for(div of $(".select-all")){
        if($(div).prop("checked")){
          data_insert.push({
            akses: $(div).val().split("-")[1],
            id_page: parseInt($(div).val().split("-")[2]),
            id_role: parseInt(id_role),
            nik:nik,
            page:$(div).val().split("-")[0],
            role:role,
            status:"checked"
          })
        }
      }
      
      data_insert_json = JSON.stringify(data_insert)
      if(data_insert_json == '[]'){
        alert('Harap Ceklist Salah Satu Access , Access Tidak Boleh kosong !!!')
      }else{
        $.ajax({
          url: '/api/m-akses-management',
          type: "PUT",
          contentType: 'application/json',
          data: data_insert_json,
          success: function(response){
            $('#modal-update').modal('hide')
            table.draw('page')
            alertModal[response.status](response.message)
          },
          error: function (xhr, status, error){
            alert('Unauthorized. Please log in.')
            location.reload();
          }
        })
      }
      
    })

    async function renderAccess(data){
      await $.ajax({
        url: '/api/m-pages',
        type: 'GET',
        success: function(response){
          memek = {}
          keymemek = []
          page_ids = {}
          for(rmek of response.data){
            if(memek.hasOwnProperty(rmek.page)){
              memek[rmek.page].push(`${rmek.page}-${rmek.crud}`)
              page_ids[`${rmek.page}-${rmek.crud}`] = rmek.id
            }else{
              memek[rmek.page] = []
              keymemek.push(rmek.page)
              memek[rmek.page].push(`${rmek.page}-${rmek.crud}`)
              page_ids[`${rmek.page}-${rmek.crud}`] = rmek.id
            }
          }
          htmpekl = `<tr>
                      <td class="text-nowrap fw-medium">
                        Administrator Access
                        <i
                          class="ri-information-line"
                          data-bs-toggle="tooltip"
                          data-bs-placement="top"
                          title="Allows a full access to the system"></i>
                      </td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td>
                        <div class="d-flex justify-content-end">
                          <div class="form-check mb-0 mt-1">
                            <input class="form-check-input" type="checkbox" id="selectAll" />
                            <label class="form-check-label"> Select All </label>
                          </div>
                        </div>
                      </td>
                    </tr>`
            for(kmek of keymemek){
            contol_hide = memek[kmek].includes(`${kmek}-C`)?'':'d-none'
            rontol_hide = memek[kmek].includes(`${kmek}-R`)?'':'d-none'
            uontol_hide = memek[kmek].includes(`${kmek}-U`)?'':'d-none'
            dontol_hide = memek[kmek].includes(`${kmek}-D`)?'':'d-none'
            contol_select = memek[kmek].includes(`${kmek}-C`)==false?'':'select-all'
            rontol_select = memek[kmek].includes(`${kmek}-R`)==false?'':'select-all'
            uontol_select = memek[kmek].includes(`${kmek}-U`)==false?'':'select-all'
            dontol_select = memek[kmek].includes(`${kmek}-D`)==false?'':'select-all'
            contol = data.includes(`${kmek}-C`)?'checked':''
            rontol = data.includes(`${kmek}-R`)?'checked':''
            uontol = data.includes(`${kmek}-U`)?'checked':''
            dontol = data.includes(`${kmek}-D`)?'checked':''
            htmpekl += `<tr>`
            htmpekl += ` <td class="text-nowrap fw-medium">${kmek}</td>
                      <td>
                        <div class="d-flex justify-content-end ${rontol_hide}">
                          <div class="form-check mb-0 mt-1 me-4 me-lg-12">
                            <input class="form-check-input ${rontol_select}" id="${kmek}_R" value="${kmek}-R-${page_ids[`${kmek}-R`]}" type="checkbox" ${rontol}/>
                            <label class="form-check-label"> View </label>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex justify-content-end ${contol_hide}" >
                          <div class="form-check mb-0 mt-1 me-4 me-lg-12">
                            <input class="form-check-input ${contol_select}" id="${kmek}_C" value="${kmek}-C-${page_ids[`${kmek}-C`]}" type="checkbox" ${contol}/>
                            <label class="form-check-label"> Create </label>
                          </div>
                  
                        </div>
                      </td>
                      <td>
                        <div class="d-flex justify-content-end ${uontol_hide}">
                          <div class="form-check mb-0 mt-1 me-4 me-lg-12">
                            <input class="form-check-input ${uontol_select}" id="${kmek}_U" value="${kmek}-U-${page_ids[`${kmek}-U`]}" type="checkbox" ${uontol}/>
                            <label class="form-check-label"> Update </label>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex justify-content-end ${dontol_hide}">
                          <div class="form-check mb-0 mt-1">
                            <input class="form-check-input ${dontol_select}" id="${kmek}_D" value="${kmek}-D-${page_ids[`${kmek}-D`]}" type="checkbox" ${dontol}/>
                            <label class="form-check-label"> Delete </label>
                          </div>
                        </div>
                      </td>`
            htmpekl += '</tr>'
          }
          $("#table_det tbody").html(htmpekl)
        }
      })
    }

    $(document).on("click", ".delete-record", function (event) {
      event.preventDefault()
      rdata = table.row($(this).closest('tr')).data()
      $('#id-delete').val(rdata.id)
      $('#nik-delete').val(rdata.nik)
      $('#modal-delete').modal('show')
    })

    $(document).on("submit", "#delete-form", function (event) {
      event.preventDefault()
      const formData = {
        id: $('#id-delete').val(),
        nik: $('#nik-delete').val(),
      };
      $.ajax({
        url: '/api/m-akses-management',
        type: 'DELETE',
        contentType: 'application/json',
        data: JSON.stringify(formData),
        success: function (response) {
          $('#modal-delete').modal('hide')
          table.draw('page')
          alertModal[response.status](response.message)
        },
        error: function (xhr, status, error) {
          alert('Unauthorized. Please log in.')
          location.reload();
        }
      });
    })

    async function renderAccessView(data){
      await $.ajax({
        url: '/api/m-pages',
        type: 'GET',
        success: function(response){
          memek = {}
          keymemek = []
          page_ids = {}
          for(rmek of response.data){
            if(memek.hasOwnProperty(rmek.page)){
              memek[rmek.page].push(`${rmek.page}-${rmek.crud}`)
              page_ids[`${rmek.page}-${rmek.crud}`] = rmek.id
            }else{
              memek[rmek.page] = []
              keymemek.push(rmek.page)
              memek[rmek.page].push(`${rmek.page}-${rmek.crud}`)
              page_ids[`${rmek.page}-${rmek.crud}`] = rmek.id
            }
          }
          htmpekl = `<tr>
                      <td class="text-nowrap fw-medium">
                        Administrator Access
                        <i
                          class="ri-information-line"
                          data-bs-toggle="tooltip"
                          data-bs-placement="top"
                          title="Allows a full access to the system"></i>
                      </td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td>
                        <div class="d-flex justify-content-end">
                          <div class="form-check mb-0 mt-1">
                            <input class="form-check-input" type="checkbox" id="selectAllView" disabled="disabled" />
                            <label class="form-check-label"> Select All </label>
                          </div>
                        </div>
                      </td>
                    </tr>`
          for(kmek of keymemek){
            contol_hide = memek[kmek].includes(`${kmek}-C`)?'':'d-none'
            rontol_hide = memek[kmek].includes(`${kmek}-R`)?'':'d-none'
            uontol_hide = memek[kmek].includes(`${kmek}-U`)?'':'d-none'
            dontol_hide = memek[kmek].includes(`${kmek}-D`)?'':'d-none'
            contol_select = memek[kmek].includes(`${kmek}-C`)==false?'':'select-all-view'
            rontol_select = memek[kmek].includes(`${kmek}-R`)==false?'':'select-all-view'
            uontol_select = memek[kmek].includes(`${kmek}-U`)==false?'':'select-all-view'
            dontol_select = memek[kmek].includes(`${kmek}-D`)==false?'':'select-all-view'
            contol = data.includes(`${kmek}-C`)?'checked':''
            rontol = data.includes(`${kmek}-R`)?'checked':''
            uontol = data.includes(`${kmek}-U`)?'checked':''
            dontol = data.includes(`${kmek}-D`)?'checked':''
            htmpekl += `<tr>`
            htmpekl += ` <td class="text-nowrap fw-medium">${kmek}</td>
                      <td>
                        <div class="d-flex justify-content-end ${rontol_hide}">
                          <div class="form-check mb-0 mt-1 me-4 me-lg-12">
                            <input class="form-check-input ${rontol_select}" id="${kmek}_R" value="${kmek}-R-${page_ids[`${kmek}-R`]}" type="checkbox" disabled="disabled" ${rontol}/>
                            <label class="form-check-label"> View </label>
                          </div>
                        </div>
                      </td>
                      <td>
                        <div class="d-flex justify-content-end ${contol_hide}" >
                          <div class="form-check mb-0 mt-1 me-4 me-lg-12">
                            <input class="form-check-input ${contol_select}" id="${kmek}_C" value="${kmek}-C-${page_ids[`${kmek}-C`]}" type="checkbox" disabled="disabled" ${contol}/>
                            <label class="form-check-label"> Create </label>
                          </div>
                  
                        </div>
                      </td>
                      <td>
                        <div class="d-flex justify-content-end ${uontol_hide}">
                          <div class="form-check mb-0 mt-1 me-4 me-lg-12">
                            <input class="form-check-input ${uontol_select}" id="${kmek}_U" value="${kmek}-U-${page_ids[`${kmek}-U`]}" type="checkbox" disabled="disabled" ${uontol}/>
                            <label class="form-check-label"> Update </label>
                          </div>
                      
                        </div>
                      </td>
                      <td>
                        <div class="d-flex justify-content-end ${dontol_hide}">
                          <div class="form-check mb-0 mt-1">
                            <input class="form-check-input ${dontol_select}" id="${kmek}_D" value="${kmek}-D-${page_ids[`${kmek}-D`]}" type="checkbox" disabled="disabled" ${dontol}/>
                            <label class="form-check-label"> Delete </label>
                          </div>
                        </div>
                      </td>`
            htmpekl += '</tr>'
          }
          $("#table_det_view tbody").html(htmpekl)
        }
      })
    }

    async function renderDropdownRoles(id_role, role) {
      await $.ajax({
          url: '/api/m-roles',
          type: 'POST',
          data: {mode:'dropdown'},
          success: function(response){
            if(role=='DEVELOPER'){
              $("#modalRoleNameUpdate").html("<option value='DEVELOPER' selected> DEVELOPER </option>")
            }else{
              html = id_role==null?"<option value='' selected> Choose Roles </option>":""
              for(rol of response.data){
                if(rol.role!='DEVELOPER'){
                  if(rol.id==id_role){
                    html+= `<option value="${rol.id}" selected>${rol.role}</option>`
                  }else{
                    html+= `<option value="${rol.id}">${rol.role}</option>`
                  }
                }
              }
              $("#modalRoleNameUpdate").html(html)
            }
          }
        })
    }

    async function renderDropdownRolesView(id_role, role) {
      await $.ajax({
          url: '/api/m-roles',
          type: 'POST',
          data: {mode:'dropdown'},
          success: function(response){
            if(role=='DEVELOPER'){
              $("#modalRoleNameDetail").html("<option value='DEVELOPER' selected> DEVELOPER </option>")
            }else{
              html = id_role==null?"<option value='' selected> Choose Roles </option>":""
              for(rol of response.data){
                if(rol.role!='DEVELOPER'){
                  if(rol.id==id_role){
                    html+= `<option value="${rol.id}" selected disabled="disabled">${rol.role}</option>`
                  }
                }
              }
              $("#modalRoleNameDetail").html(html)
            }
          }
        })
    }

  });
</script>

{% endblock content %}

{% block javascripts %}{% endblock javascripts %}